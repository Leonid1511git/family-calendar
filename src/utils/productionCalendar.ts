/**
 * Производственный календарь РФ: выходные и праздничные дни 2026–2027.
 * Источник: переносы и праздники по постановлениям Правительства РФ.
 */

import { startOfDay } from 'date-fns';

/** Даты выходных/праздников в формате YYYY-MM-DD (дополнительно к субботам и воскресеньям). */
const EXTRA_DAYS_OFF: string[] = [
  // 2026 — Новогодние каникулы 1–11 янв; переносы: сб 3 янв → пт 9 янв, вс 4 янв → чт 31 дек
  '2026-01-01', '2026-01-02', '2026-01-03', '2026-01-04', '2026-01-05', '2026-01-06', '2026-01-07', '2026-01-08', '2026-01-09', '2026-01-10', '2026-01-11',
  '2026-02-22', '2026-02-23', // 23 февраля (+ 22 как предпраздничный выходной)
  '2026-03-08', '2026-03-09', // 8 марта (8 — вс, перенос на 9)
  '2026-05-01', '2026-05-02', '2026-05-03', '2026-05-09', '2026-05-10', '2026-05-11', // 1 мая, 9 мая
  '2026-06-12', // День России
  '2026-11-04', // День народного единства
  '2026-12-31', // перенос с 4 января
  // 2027 — типовые праздники (при необходимости уточнить по постановлению)
  '2027-01-01', '2027-01-02', '2027-01-03', '2027-01-04', '2027-01-05', '2027-01-06', '2027-01-07', '2027-01-08',
  '2027-02-23',
  '2027-03-08',
  '2027-05-01', '2027-05-02', '2027-05-03', '2027-05-09', '2027-05-10',
  '2027-06-12',
  '2027-11-04',
];

const EXTRA_SET = new Set(EXTRA_DAYS_OFF);

function toKey(d: Date): string {
  const y = d.getFullYear();
  const m = String(d.getMonth() + 1).padStart(2, '0');
  const day = String(d.getDate()).padStart(2, '0');
  return `${y}-${m}-${day}`;
}

/**
 * Проверяет, является ли дата нерабочим днём по производственному календарю РФ
 * (суббота, воскресенье или праздник/перенос для 2026–2027).
 */
export function isNonWorkingDay(date: Date): boolean {
  const d = startOfDay(date);
  const dayOfWeek = d.getDay(); // 0 = воскресенье, 6 = суббота
  if (dayOfWeek === 0 || dayOfWeek === 6) return true;
  return EXTRA_SET.has(toKey(d));
}
