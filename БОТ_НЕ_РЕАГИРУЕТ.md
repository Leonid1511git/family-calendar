# Бот не реагирует на сообщения

Если вы пишете боту (например «Баня 13го февраля в 20:00»), а бот молчит — скорее всего **Telegram не отправляет обновления на ваш сервер**, потому что не настроен webhook.

## 1. Проверьте webhook

Выполните в терминале (подставьте свой токен бота, если другой):

```bash
curl "https://api.telegram.org/bot8505904119:AAFh3Usvvaa78XuNVTaSqLEz3-YHhhE95s4/getWebhookInfo"
```

- Если в ответе **`"url": ""`** — webhook не установлен, Telegram никуда не шлёт сообщения. Переходите к шагу 2.
- Если **`"url": "https://..."`** — проверьте, что этот URL совпадает с URL вашей Cloud Function `telegramWebhook` (см. вывод `firebase deploy --only functions`).

## 2. Установите webhook

1. Задеплойте функцию (если ещё не деплоили):
   ```bash
   cd functions
   npm run build
   cd ..
   npx firebase-tools deploy --only functions:telegramWebhook
   ```
2. В выводе найдите **URL функции**, например:
   `Function URL (telegramWebhook): https://us-central1-family-calendar-22abd.cloudfunctions.net/telegramWebhook`
3. Установите этот URL как webhook (подставьте свой URL вместо `<URL>`):
   ```bash
   curl -X POST "https://api.telegram.org/bot8505904119:AAFh3Usvvaa78XuNVTaSqLEz3-YHhhE95s4/setWebhook" \
     -H "Content-Type: application/json" \
     -d '{"url": "<URL>"}'
   ```
   Пример:
   ```bash
   curl -X POST "https://api.telegram.org/bot8505904119:AAFh3Usvvaa78XuNVTaSqLEz3-YHhhE95s4/setWebhook" \
     -H "Content-Type: application/json" \
     -d '{"url": "https://us-central1-family-calendar-22abd.cloudfunctions.net/telegramWebhook"}'
   ```
4. Ожидаемый ответ: `{"ok":true,"result":true,"description":"Webhook was set"}`.
5. Снова проверьте: `curl "https://api.telegram.org/bot.../getWebhookInfo"` — в ответе должен быть ваш URL.

## 3. Проверьте логи функции

Если webhook установлен, но бот по-прежнему не отвечает:

1. Откройте [Firebase Console](https://console.firebase.google.com/) → ваш проект → **Functions** → **Logs**.
2. Напишите боту сообщение (например «Баня 13го февраля в 20:00») и посмотрите, появляются ли в логах строки вроде:
   - `Received update: ...`
   - `Processing message from user ...`
   - `Event created successfully...` или сообщения об ошибках.

Если логов нет — Telegram не доставляет обновления до функции (проверьте URL webhook и регион функции). Если есть ошибки — исправьте по тексту ошибки (например «Пользователь не найден» значит, что в Firestore нет пользователя с вашим `telegramId`; сначала войдите в приложение через Telegram).

## 4. Формат сообщений

Бот понимает фразы вида:

- **Баня 13го февраля в 20:00**
- Баня 15го в 18
- Театр суббота 19:00
- ДР Игоря завтра в 15

Парсинг дат и времени уже поддерживает «13го февраля в 20:00».
