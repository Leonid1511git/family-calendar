# Family Calendar - –°–µ–º–µ–π–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å v2.0

–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –≤–µ–¥–µ–Ω–∏—è —Å–µ–º–µ–π–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ –∏ —Å–æ–±—ã—Ç–∏–π —Å –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–æ–º, –≥–æ–ª–æ—Å–æ–≤—ã–º –≤–≤–æ–¥–æ–º –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π.

## üöÄ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥
- –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –∏ –≥–æ–≤–æ—Ä–∏—Ç–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –¥–∞—Ç –∏ –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ `chrono-node`
- –ü—Ä–∏–º–µ—Ä—ã —Ñ—Ä–∞–∑:
  - "–í—Å—Ç—Ä–µ—á–∞ —Å –∫–ª–∏–µ–Ω—Ç–æ–º –∑–∞–≤—Ç—Ä–∞ –≤ 15:00"
  - "–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –º–∞–º—ã 15 –º–∞—Ä—Ç–∞"
  - "–ó–∞–±—Ä–∞—Ç—å –¥–µ—Ç–µ–π –∏–∑ —à–∫–æ–ª—ã —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞"

### 2. Offline-First
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ AsyncStorage
- –†–∞–±–æ—Ç–∞ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Å–µ—Ç–∏
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ —à–∞–ø–∫–µ

### 3. –ì—Ä—É–ø–ø—ã –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- Firestore —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞
- –¢–æ–ª—å–∫–æ —á–ª–µ–Ω—ã –≥—Ä—É–ø–ø—ã –≤–∏–¥—è—Ç —Å–æ–±—ã—Ç–∏—è
- –†–æ–ª–∏: admin (–º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ) –∏ member (—Ç–æ–ª—å–∫–æ —Å–≤–æ–∏)
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≥—Ä—É–ø–ø–∞ "–°–µ–º—å—è"

### 4. Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (FCM)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è –¥—Ä—É–≥–∏–º —á–ª–µ–Ω–æ–º –≥—Ä—É–ø–ø—ã
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ N –≤—Ä–µ–º–µ–Ω–∏ –¥–æ —Å–æ–±—ã—Ç–∏—è (15 –º–∏–Ω - 3 –¥–Ω—è)
- Deeplink: —Ç–∞–ø –ø–æ –ø—É—à—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ

### 5. –ö–∞–ª–µ–Ω–¥–∞—Ä—å
- 3 —Ä–µ–∂–∏–º–∞: –ú–µ—Å—è—Ü / –ù–µ–¥–µ–ª—è / –î–µ–Ω—å
- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
- 5 —Ü–≤–µ—Ç–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–æ–±—ã—Ç–∏–π

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **React Native + Expo SDK 54**
- **TypeScript**
- **AsyncStorage** - –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- **Firebase Firestore** - –æ–±–ª–∞—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- **chrono-node** - –ø–∞—Ä—Å–∏–Ω–≥ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–∞—Ç
- **expo-speech** - –≥–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥
- **expo-notifications** - push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## üì± –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
cd family-calendar-v2
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firebase

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ [Firebase Console](https://console.firebase.google.com/)
2. –î–æ–±–∞–≤—å—Ç–µ Android –∏ iOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. –°–∫–∞—á–∞–π—Ç–µ `google-services.json` (Android) –∏ `GoogleService-Info.plist` (iOS)
4. –ü–æ–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª—ã –≤:
   - Android: `android/app/google-services.json` (—É–∂–µ –Ω–∞ –º–µ—Å—Ç–µ)
   - iOS: `ios/GoogleService-Info.plist`
5. –û–±–Ω–æ–≤–∏—Ç–µ `firebaseConfig` –≤ `src/services/firebase.ts`

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Expo

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Expo CLI
npm install -g expo-cli

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ EAS CLI
npm install -g eas-cli

# –í–æ–π–¥–∏—Ç–µ –≤ Expo
eas login
```

### 4. –ó–∞–ø—É—Å–∫

```bash
# Development mode (—Å –æ—á–∏—Å—Ç–∫–æ–π –∫—ç—à–∞)
npx expo start --clear

# Android
npm run android

# iOS (—Ç—Ä–µ–±—É–µ—Ç—Å—è macOS + Xcode)
npm run ios
```

**–í–∞–∂–Ω–æ:** –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∏–ª–∏ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `npx expo start --clear` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞ Metro bundler.

## üì¶ –°–±–æ—Ä–∫–∞

### Preview APK (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```bash
eas build --profile preview --platform android
```

### Production

```bash
# Android
eas build --profile production --platform android

# iOS
eas build --profile production --platform ios
```

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ voice/
‚îÇ       ‚îî‚îÄ‚îÄ VoiceInputButton.tsx    # –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                     # AsyncStorage –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ screens/
‚îÇ   ‚îú‚îÄ‚îÄ AuthScreen.tsx               # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ CalendarScreen.tsx           # –ö–∞–ª–µ–Ω–¥–∞—Ä—å (–º–µ—Å—è—Ü/–Ω–µ–¥–µ–ª—è/–¥–µ–Ω—å)
‚îÇ   ‚îú‚îÄ‚îÄ CreateEventScreen.tsx        # –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ EventDetailsScreen.tsx       # –î–µ—Ç–∞–ª–∏ —Å–æ–±—ã—Ç–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ EventsListScreen.tsx         # –°–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ SettingsScreen.tsx           # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ firebase.ts                  # Firestore –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ syncService.ts               # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ notificationService.ts       # Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ context/
‚îÇ   ‚îú‚îÄ‚îÄ ThemeContext.tsx             # –¢–µ–º—ã (light/dark)
‚îÇ   ‚îú‚îÄ‚îÄ AuthContext.tsx              # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ EventsContext.tsx            # –°–æ–±—ã—Ç–∏—è
‚îú‚îÄ‚îÄ constants/
‚îÇ   ‚îú‚îÄ‚îÄ light.ts                     # –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞
‚îÇ   ‚îî‚îÄ‚îÄ dark.ts                      # –¢—ë–º–Ω–∞—è —Ç–µ–º–∞
‚îî‚îÄ‚îÄ types/
    ‚îî‚îÄ‚îÄ index.ts                     # TypeScript —Ç–∏–ø—ã
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è Production

### 1. Firebase Security Rules

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Groups
    match /groups/{groupId} {
      allow read: if request.auth != null && 
        exists(/databases/$(database)/documents/groups/$(groupId)/members/$(request.auth.uid));
      allow create: if request.auth != null;
      allow update: if request.auth != null && 
        get(/databases/$(database)/documents/groups/$(groupId)/members/$(request.auth.uid)).data.role == 'admin';
    }
    
    // Group members
    match /groups/{groupId}/members/{userId} {
      allow read: if request.auth != null && 
        exists(/databases/$(database)/documents/groups/$(groupId)/members/$(request.auth.uid));
      allow write: if request.auth != null && 
        (request.auth.uid == userId || 
         get(/databases/$(database)/documents/groups/$(groupId)/members/$(request.auth.uid)).data.role == 'admin');
    }
    
    // Events
    match /events/{eventId} {
      allow read: if request.auth != null && 
        exists(/databases/$(database)/documents/groups/$(resource.data.groupId)/members/$(request.auth.uid));
      allow create: if request.auth != null && 
        exists(/databases/$(database)/documents/groups/$(request.resource.data.groupId)/members/$(request.auth.uid));
      allow update: if request.auth != null && 
        (resource.data.createdBy == request.auth.uid || 
         get(/databases/$(database)/documents/groups/$(resource.data.groupId)/members/$(request.auth.uid)).data.role == 'admin');
      allow delete: if request.auth != null && 
        (resource.data.createdBy == request.auth.uid || 
         get(/databases/$(database)/documents/groups/$(resource.data.groupId)/members/$(request.auth.uid)).data.role == 'admin');
    }
    
    // Users
    match /users/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
```

### 2. Firebase Cloud Functions –¥–ª—è Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```javascript
const functions = require('firebase-functions');
const admin = require('firebase-admin');
admin.initializeApp();

exports.sendEventNotification = functions.firestore
  .document('events/{eventId}')
  .onCreate(async (snap, context) => {
    const event = snap.data();
    const groupId = event.groupId;
    const creatorId = event.createdBy;
    
    // Get group members
    const membersSnapshot = await admin.firestore()
      .collection('groups')
      .doc(groupId)
      .collection('members')
      .get();
    
    const tokens = [];
    
    for (const memberDoc of membersSnapshot.docs) {
      if (memberDoc.id === creatorId) continue;
      
      const userDoc = await admin.firestore()
        .collection('users')
        .doc(memberDoc.id)
        .get();
      
      if (userDoc.exists && userDoc.data().fcmToken) {
        tokens.push(userDoc.data().fcmToken);
      }
    }
    
    if (tokens.length === 0) return;
    
    // Get creator name
    const creatorDoc = await admin.firestore()
      .collection('users')
      .doc(creatorId)
      .get();
    
    const creatorName = creatorDoc.exists 
      ? creatorDoc.data().firstName 
      : '–ö—Ç–æ-—Ç–æ';
    
    // Send notifications
    const message = {
      notification: {
        title: '–ù–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ',
        body: `${creatorName} –¥–æ–±–∞–≤–∏–ª: ${event.title}`,
      },
      data: {
        eventId: context.params.eventId,
        groupId: groupId,
        type: 'new_event',
      },
      tokens: tokens,
    };
    
    await admin.messaging().sendMulticast(message);
  });
```

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
